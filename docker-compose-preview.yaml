services:
  preview-explorer-backend:
    depends_on:
      - redis
    restart: unless-stopped
    build:
      context: .
      args:
        - GIT_BRANCH=${GIT_BRANCH}
    env_file:
      - ./backend/.env
    deploy:
      resources:
        limits:
          memory: 4096M

  preview-redis:
    # https://github.com/docker-library/redis/blob/b77450d/7.4/alpine/Dockerfile
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      # Redis' WORKDIR is /data
      - preview-redis-data:/data
      - ./backend/redis.conf:/usr/local/etc/redis/redis.conf:ro
    command: /usr/local/etc/redis/redis.conf

volumes:
  preview-redis-data:
